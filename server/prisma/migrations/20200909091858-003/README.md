# Migration `20200909091858-003`

This migration has been generated by IgweDaniel at 9/9/2020, 10:18:58 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "_DocToUser" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL,

    FOREIGN KEY ("A") REFERENCES "Doc"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("B") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "_UserToDocBlacklist" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL,

    FOREIGN KEY ("A") REFERENCES "Doc"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("B") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE UNIQUE INDEX "_DocToUser_AB_unique" ON "_DocToUser"("A", "B")

CREATE INDEX "_DocToUser_B_index" ON "_DocToUser"("B")

CREATE UNIQUE INDEX "_UserToDocBlacklist_AB_unique" ON "_UserToDocBlacklist"("A", "B")

CREATE INDEX "_UserToDocBlacklist_B_index" ON "_UserToDocBlacklist"("B")

PRAGMA foreign_keys=off;
DROP TABLE "Collaboration";
PRAGMA foreign_keys=on
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200908211826-002..20200909091858-003
--- datamodel.dml
+++ datamodel.dml
@@ -2,38 +2,31 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
 model Doc {
-  id       Int             @id @default(autoincrement())
-  name     String          @unique
-  content  String?
-  password String?
-  owner    User?           @relation(fields: [ownerId], references: [id])
-  ownerId  Int?
-  collabs  Collaboration[]
+  id        Int     @id @default(autoincrement())
+  name      String  @unique
+  content   String?
+  password  String?
+  owner     User?   @relation(fields: [ownerId], references: [id], name: "owner")
+  ownerId   Int?
+  collabers User[]  @relation(references: [id])
+  blacklist User[]  @relation("UserToDocBlacklist", references: [id])
 }
 model User {
-  id         Int             @id @default(autoincrement())
-  email      String          @unique
-  name       String?
-  password   String
-  docs       Doc[]
-  sharedDocs Collaboration[]
+  id              Int     @id @default(autoincrement())
+  email           String  @unique
+  name            String?
+  password        String
+  docs            Doc[]   @relation("owner")
+  sharedDocs      Doc[]   @relation(references: [id])
+  blacklistedDocs Doc[]   @relation("UserToDocBlacklist", references: [id])
 }
-
-model Collaboration {
-  doc       Doc      @relation(fields: [docId], references: [id])
-  docId     Int // relation scalar field (used in the `@relation` attribute above)
-  user      User     @relation(fields: [userId], references: [id])
-  userId    Int // relation scalar field (used in the `@relation` attribute above)
-  createdAt DateTime @default(now())
-  @@id([docId, userId])
-}
```


